model:
  weights: yolov8n.pt
  device: cpu
  imgsz: 640
tracking:
  conf: 0.25
  iou: 0.45
  max_det: 1000
  tracker_config: configs/tracker/bytetrack.yaml
detect:
  plate_imgsz: 1280     # 车牌检测推理尺寸
  use_sahi: true        # 大分辨率时启用切片推理
  tile_size: 1024
  tile_overlap: 0.2

roi:
  enable: true  # 是否启用 ROI 裁剪逻辑
  mode: laneatt  # manual=使用已有 JSON，laneatt=LaneATT 自动生成 ROI，auto_cv=旧版自动估计
  dir: data/rois  # ROI 输出目录，建议加入 .gitignore，pull 后需重新生成
  path: ""  # 兼容旧配置，若提供则覆盖 dir 推导的路径
  auto_cv:
    sample_frames: 18        # 自动 ROI 检测时抽样的帧数
    crop_right: 0.45         # 右侧裁剪比例，聚焦车道线区域
    crop_bottom: 0.70        # 底部裁剪比例，过滤远处噪声
    s_max: 70                # HSV 饱和度上限，突出白色标线
    v_min: 190               # HSV 亮度下限，排除暗噪声
    angle_min: 18.0          # 允许的车道线最小角度（度）
    angle_max: 78.0          # 允许的车道线最大角度（度）
    top_ratio: 0.33          # ROI 顶部相对于图像高度的比例
    bottom_margin: 18        # ROI 底部的安全边距（像素）
    buffer: 6                # 沿检测到的车道线向内偏移的像素
    min_box_h_px: 30         # ROI 多边形的最小高度（像素）
    min_rel_area: 0.003      # ROI 面积占整帧的最小比例
    min_sharpness: 60.0      # ROI 内部的最小清晰度（拉普拉斯方差）
    bbox_aspect_min: 0.6     # ROI 多边形宽高比的最小值
    only_with_plate: false   # 若为 true 需要清晰度达标才视为成功
    allow_tail_fallback: true  # 失败时是否允许保留上一轮 ROI
    save_debug: true         # 保存自动 ROI 可视化叠加图
    track_min_frames: 6      # 预留：用于调参报告记录的跟踪帧阈值
    entry_window_frames: 12  # 预留：调参脚本可使用的窗口大小
    per_track: true          # 预留：调参脚本是否逐轨迹记录
  laneatt:
    sample_frames: 18           # LaneATT 推理时抽样的帧数
    top_ratio: 0.35             # ROI 顶部相对高度（0~1），越小越靠近图像下方
    bottom_margin: 18           # ROI 底部距离图像底边的安全边距（像素）
    buffer: 12                  # ROI 相对车道线向右偏移的像素
    min_score: 0.05             # 接受的 LaneATT 最小置信度
    min_lane_frames: 4          # 至少检测到多少帧车道线才认为成功
    allow_auto_cv_fallback: false  # 失败时是否回退到 auto_cv 逻辑
    save_debug: true            # 是否保存 LaneATT 调试叠加图
    laneatt:
      weights: weights/model_0015.pt              # LaneATT 权重文件路径，留空则使用启发式回退
      device: auto             # 推理设备（auto / cpu / cuda:0 等）
      min_length_px: 80        # 车道线最小长度（像素）
      canny_threshold1: 80     # Canny 边缘检测阈值 1（回退模式）
      canny_threshold2: 160    # Canny 边缘检测阈值 2（回退模式）
      hough_threshold: 50      # 霍夫直线检测阈值（回退模式）
      hough_min_line_length: 60  # 霍夫检测直线最小长度（像素）
      hough_max_line_gap: 40   # 霍夫检测允许的最大断裂（像素）
      angle_range: [15.0, 80.0]  # 允许的车道线角度范围（度）
      right_lane_only: true    # 是否只保留最右侧的候选车道线
events:
  min_frames_in: 5
  min_frames_out: 5
render:
  show_tracks: true
  show_footpoints: true
output:
  dir: data/outputs
  clip_dir: clips
  plate_dir: plates
plate:
  enable: true
  det_weights: weights/plate/yolov8n-plate.pt
  device: cpu
  imgsz: 320
  conf: 0.25
  iou: 0.45
  every_n_frames: 2
  crop_padding: 0.15
  min_rel_area: 0.01
  min_sharpness: 120.0
  save_debug: false
  classes_allow:
  - car
  - truck
  - bus
  bbox_aspect_min: 0.9
  min_box_h_px: 60
  only_with_plate: true
  allow_tail_fallback: false
  pick_mode: entry
  entry_window_frames: 15
  per_track: true
  plate_crop_imgsz: 640
  plate_crop_conf: 0.20
  plate_crop_margin: 0.12
  fine_crop_mode: reuse_bbox
  plate_crop_area_fail_ratio: 0.92
  preproc:
    enable: true
    upscale_min_side: 320
    deskew_max_deg: 12
    use_perspective: true
    clahe_clip: 2.0
    clahe_grid: 8
    denoise: bilateral
    unsharp_amount: 0.6
    unsharp_radius: 3
    binarize: false
    save_debug: false

plate_crop_margin: 0.12
plate_crop_min_height: 64
plate_crop_redetect: false
plate_crop_imgsz: 640
plate_aspect_min: 2.0
plate_aspect_max: 5.0
debug_draw: false

save_fine_plate: true
save_gray_plate: false

plate_weights: weights/plate/yolov8n-plate.pt
plate_enabled: true
